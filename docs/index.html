<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4A90E2">
    <meta name="description" content="Your AI-powered Second Brain">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>M2B - Second Brain</title>

    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- App Container -->
    <div id="app" class="app-container">

        <!-- Header -->
        <header class="app-header">
            <h1 class="app-title">
                <svg class="icon icon-brain" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M12 18V5" />
                    <path d="M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4" />
                    <path d="M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5" />
                    <path d="M17.997 5.125a4 4 0 0 1 2.526 5.77" />
                    <path d="M18 18a4 4 0 0 0 2-7.464" />
                    <path d="M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517" />
                    <path d="M6 18a4 4 0 0 1-2-7.464" />
                    <path d="M6.003 5.125a4 4 0 0 0-2.526 5.77" />
                </svg>
                M2B
            </h1>
            <div class="header-actions">
                <button id="syncBtn" class="icon-btn" title="Sync">
                    <svg class="icon sync-icon icon-refresh-cw" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
                        <path d="M21 3v5h-5" />
                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
                        <path d="M8 16H3v5" />
                    </svg>
                </button>
                <button id="settingsBtn" class="icon-btn" title="Settings">
                    <svg class="icon icon-settings" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bottom-nav">
            <button class="nav-btn active" data-view="capture">
                <span class="nav-icon">
                    <svg class="icon icon-inbox" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <polyline points="22 12 16 12 14 15 10 15 8 12 2 12" />
                        <path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z" />
                    </svg>
                </span>
                <span class="nav-label">Capture</span>
            </button>
            <button class="nav-btn" data-view="shopping">
                <span class="nav-icon">
                    <svg class="icon icon-shopping-cart" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <circle cx="8" cy="21" r="1" />
                        <circle cx="19" cy="21" r="1" />
                        <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12" />
                    </svg>
                </span>
                <span class="nav-label">Shopping</span>
            </button>
            <button class="nav-btn" data-view="tasks">
                <span class="nav-icon">
                    <svg class="icon icon-check-square" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344" />
                        <path d="m9 11 3 3L22 4" />
                    </svg>
                </span>
                <span class="nav-label">Tasks</span>
            </button>
            <button class="nav-btn" data-view="ideas">
                <span class="nav-icon">
                    <svg class="icon icon-lightbulb" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5" />
                        <path d="M9 18h6" />
                        <path d="M10 22h4" />
                    </svg>
                </span>
                <span class="nav-label">Ideas</span>
            </button>
            <button class="nav-btn" data-view="more">
                <span class="nav-icon">
                    <svg class="icon icon-more-horizontal" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                        <circle cx="12" cy="12" r="1" />
                        <circle cx="19" cy="12" r="1" />
                        <circle cx="5" cy="12" r="1" />
                    </svg>
                </span>
                <span class="nav-label">More</span>
            </button>
        </nav>

        <!-- Main Content Area -->
        <main class="app-main">

            <!-- Capture View -->
            <div id="captureView" class="view active">
                <div class="view-header">
                    <h2>Quick Capture</h2>
                    <p class="view-subtitle">Type naturally - AI will classify and file it</p>
                </div>

                <div class="capture-form">
                    <textarea
                        id="captureInput"
                        placeholder="Buy milk&#10;Idea: Build a recipe app&#10;Call dentist tomorrow&#10;Met Sarah - wants to collaborate"
                        rows="6"
                    ></textarea>

                    <div class="capture-actions">
                        <button id="captureBtn" class="btn btn-primary">
                            <span class="btn-icon">
                                <svg class="icon icon-inbox" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                    <polyline points="22 12 16 12 14 15 10 15 8 12 2 12" />
                                    <path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z" />
                                </svg>
                            </span>
                            Capture
                        </button>
                        <button id="holdToTalkBtn" class="btn btn-secondary btn-hold" aria-label="Hold to talk">
                            <span class="btn-icon">
                                <svg class="icon icon-mic" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" />
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                                    <line x1="12" y1="19" x2="12" y2="23" />
                                    <line x1="8" y1="23" x2="16" y2="23" />
                                </svg>
                            </span>
                            Hold to talk
                        </button>
                    </div>
                </div>

                <div id="captureQueue" class="queue-section hidden">
                    <h3>Offline Queue</h3>
                    <div id="queueList" class="queue-list"></div>
                </div>

                <div class="capture-examples">
                    <h3>Examples:</h3>
                    <ul>
                        <li><strong>Shopping:</strong> "Buy milk, eggs, bread"</li>
                        <li><strong>Task:</strong> "Call dentist tomorrow"</li>
                        <li><strong>Idea:</strong> "Idea: Build plant watering tracker app"</li>
                        <li><strong>Person:</strong> "Met John for coffee - wants to collaborate"</li>
                    </ul>
                </div>
            </div>

            <!-- Shopping View -->
            <div id="shoppingView" class="view">
                <div class="view-header">
                    <h2>Shopping List</h2>
                    <button id="clearCompletedBtn" class="btn btn-small">Clear Completed</button>
                </div>

                <div id="shoppingContent" class="content-area">
                    <div class="loading">Loading shopping list...</div>
                </div>
            </div>

            <!-- Tasks View -->
            <div id="tasksView" class="view">
                <div class="view-header">
                    <h2>Tasks</h2>
                    <div class="tabs">
                        <button class="tab active" data-context="personal">Personal</button>
                        <button class="tab" data-context="work">Work</button>
                    </div>
                </div>

                <div id="tasksContent" class="content-area">
                    <div class="loading">Loading tasks...</div>
                </div>
            </div>

            <!-- Ideas View -->
            <div id="ideasView" class="view">
                <div class="view-header">
                    <h2>Ideas</h2>
                    <div class="domain-filters">
                        <button class="filter-btn active" data-domain="all">All</button>
                        <button class="filter-btn" data-domain="tech">Tech</button>
                        <button class="filter-btn" data-domain="business">Business</button>
                        <button class="filter-btn" data-domain="personal">Personal</button>
                        <button class="filter-btn" data-domain="creative">Creative</button>
                    </div>
                </div>

                <div id="ideasContent" class="content-area">
                    <div class="loading">Loading ideas...</div>
                </div>
            </div>

            <!-- More View -->
            <div id="moreView" class="view">
                <div class="view-header">
                    <h2>More</h2>
                </div>

                <div class="menu-list">
                    <button class="menu-item" data-action="files">
                        <span class="menu-icon">
                            <svg class="icon icon-file-text" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                                <polyline points="14 2 14 8 20 8" />
                                <line x1="16" y1="13" x2="8" y2="13" />
                                <line x1="16" y1="17" x2="8" y2="17" />
                                <line x1="10" y1="9" x2="8" y2="9" />
                            </svg>
                        </span>
                        <div class="menu-content">
                            <div class="menu-title">View Files</div>
                            <div class="menu-subtitle">Browse all markdown files</div>
                        </div>
                    </button>

                    <button class="menu-item" data-action="digest">
                        <span class="menu-icon">
                            <svg class="icon icon-bar-chart-3" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <path d="M3 3v16a2 2 0 0 0 2 2h16" />
                                <path d="M18 17V9" />
                                <path d="M13 17V5" />
                                <path d="M8 17v-3" />
                            </svg>
                        </span>
                        <div class="menu-content">
                            <div class="menu-title">Daily Digest</div>
                            <div class="menu-subtitle">See today's priorities</div>
                        </div>
                    </button>

                    <button class="menu-item" data-action="projects">
                        <span class="menu-icon">
                            <svg class="icon icon-folder" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <path d="M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z" />
                            </svg>
                        </span>
                        <div class="menu-content">
                            <div class="menu-title">Projects</div>
                            <div class="menu-subtitle">Active, waiting, blocked</div>
                        </div>
                    </button>

                    <button class="menu-item" data-action="people">
                        <span class="menu-icon">
                            <svg class="icon icon-users" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                                <path d="M16 3.128a4 4 0 0 1 0 7.744" />
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
                                <circle cx="9" cy="7" r="4" />
                            </svg>
                        </span>
                        <div class="menu-content">
                            <div class="menu-title">People</div>
                            <div class="menu-subtitle">Contacts and relationships</div>
                        </div>
                    </button>

                    <button class="menu-item" data-action="search">
                        <span class="menu-icon">
                            <svg class="icon icon-search" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <path d="m21 21-4.34-4.34" />
                                <circle cx="11" cy="11" r="8" />
                            </svg>
                        </span>
                        <div class="menu-content">
                            <div class="menu-title">Search</div>
                            <div class="menu-subtitle">Find anything</div>
                        </div>
                    </button>

                    <button class="menu-item" data-action="inbox">
                        <span class="menu-icon">
                            <svg class="icon icon-inbox" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                                <polyline points="22 12 16 12 14 15 10 15 8 12 2 12" />
                                <path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z" />
                            </svg>
                        </span>
                        <div class="menu-content">
                            <div class="menu-title">Inbox Log</div>
                            <div class="menu-subtitle">Audit trail</div>
                        </div>
                    </button>
                </div>
            </div>

        </main>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button class="close-btn">&times;</button>
                </div>

                <div class="modal-body">
                    <div class="setting-group">
                        <label for="githubToken">GitHub Token</label>
                        <input
                            type="password"
                            id="githubToken"
                            placeholder="ghp_xxxxxxxxxxxxx"
                        >
                        <p class="help-text">
                            Create a token at
                            <a href="https://github.com/settings/tokens/new" target="_blank">
                                github.com/settings/tokens
                            </a>
                            with repo permissions
                        </p>
                    </div>

                    <div class="setting-group">
                        <label for="githubRepo">Repository</label>
                        <input
                            type="text"
                            id="githubRepo"
                            placeholder="username/M2B"
                            value="chrisbarkerza/M2B"
                        >
                    </div>

                    <div class="setting-group">
                        <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
                        <button id="testConnectionBtn" class="btn btn-secondary">Test Connection</button>
                    </div>

                    <div class="setting-group">
                        <h3>Offline Data</h3>
                        <p>Last synced: <span id="lastSync">Never</span></p>
                        <button id="clearCacheBtn" class="btn btn-danger">Clear Cache</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- File Viewer Modal -->
        <div id="fileViewerModal" class="modal hidden">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>Markdown Files</h2>
                    <button class="close-btn" onclick="UI.closeFileViewer()">&times;</button>
                </div>

                <div class="modal-body">
                    <div id="fileTree" class="file-tree">
                        <div class="loading">Loading files...</div>
                    </div>
                    <div id="fileContent" class="file-content hidden">
                        <div class="file-content-header">
                            <button class="btn btn-small" onclick="UI.closeFileContent()">
                                <svg class="icon icon-arrow-left" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="m12 19-7-7 7-7" />
                                    <path d="M19 12H5" />
                                </svg>
                                Back to list
                            </button>
                            <h3 id="fileTitle"></h3>
                        </div>
                        <div id="fileContentBody" class="markdown-content"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Projects Modal -->
        <div id="projectsModal" class="modal hidden">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>Projects</h2>
                    <button class="close-btn" onclick="UI.closeProjects()">&times;</button>
                </div>

                <div class="modal-body">
                    <div class="tabs">
                        <button class="tab active" data-status="active">Active</button>
                        <button class="tab" data-status="waiting">Waiting</button>
                        <button class="tab" data-status="blocked">Blocked</button>
                        <button class="tab" data-status="done">Done</button>
                    </div>
                    <div id="projectsList" class="projects-list">
                        <div class="loading">Loading projects...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- People Modal -->
        <div id="peopleModal" class="modal hidden">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>People</h2>
                    <button class="close-btn" onclick="UI.closePeople()">&times;</button>
                </div>

                <div class="modal-body">
                    <div class="tabs">
                        <button class="tab active" data-category="all">All</button>
                        <button class="tab" data-category="professional">Professional</button>
                        <button class="tab" data-category="family">Family</button>
                        <button class="tab" data-category="friends">Friends</button>
                    </div>
                    <div id="peopleList" class="people-list">
                        <div class="loading">Loading people...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Modal -->
        <div id="searchModal" class="modal hidden">
            <div class="modal-content modal-large">
                <div class="modal-header">
                    <h2>Search</h2>
                    <button class="close-btn" onclick="UI.closeSearch()">&times;</button>
                </div>

                <div class="modal-body">
                    <div class="search-input-wrapper">
                        <input type="text" id="searchInput" placeholder="Search anything..." class="search-input">
                    </div>
                    <div id="searchResults" class="search-results">
                        <div class="empty-state">Enter a search term to find files, tasks, ideas, people, and more.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Toast -->
        <div id="toast" class="toast hidden"></div>

        <!-- Offline Indicator -->
        <div id="offlineIndicator" class="offline-indicator hidden">
            <svg class="icon icon-wifi-off" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M12 20h.01" />
                <path d="M8.5 16.429a5 5 0 0 1 7 0" />
                <path d="M5 12.859a10 10 0 0 1 5.17-2.69" />
                <path d="M19 12.859a10 10 0 0 0-2.007-1.523" />
                <path d="M2 8.82a15 15 0 0 1 4.177-2.643" />
                <path d="M22 8.82a15 15 0 0 0-11.288-3.764" />
                <path d="m2 2 20 20" />
            </svg>
            Offline - Changes will sync when online
        </div>

    </div>

    <script src="js/app.js"></script>
    <script>
        // Register service worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(reg => console.log('Service Worker registered', reg))
                .catch(err => console.log('Service Worker registration failed', err));
        }
    </script>
</body>
</html>
